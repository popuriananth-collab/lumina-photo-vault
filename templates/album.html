<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lumina — {{ album_name }}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300&family=DM+Mono:wght@300;400&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --bg:#0c0c0d; --surface:#141416; --surface2:#1e1e21;
      --border:#2a2a2e; --gold:#c8a96e; --gold-dim:#8a7048;
      --text:#e8e4dc; --text-muted:#7a7670;
      --danger:#c0504a; --success:#5a9a6a; --blue:#90b8d8;
    }
    *, *::before, *::after { box-sizing:border-box; margin:0; padding:0; }
    body { background:var(--bg); color:var(--text); font-family:'DM Mono',monospace; font-weight:300; min-height:100vh; overflow-x:hidden; }
    body::before {
      content:''; position:fixed; inset:0; pointer-events:none; z-index:0;
      background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.035'/%3E%3C/svg%3E");
    }
    @keyframes fadeDown { from{opacity:0;transform:translateY(-10px)} to{opacity:1;transform:translateY(0)} }
    @keyframes fadeUp   { from{opacity:0;transform:translateY(16px)}  to{opacity:1;transform:translateY(0)} }
    @keyframes scaleIn  { from{opacity:0;transform:scale(0.96)}       to{opacity:1;transform:scale(1)} }
    @keyframes fadeIn   { from{opacity:0} to{opacity:1} }
    @keyframes pulse    { 0%,100%{opacity:1} 50%{opacity:0.25} }
    @keyframes slideIn  { from{transform:translateX(20px);opacity:0} to{transform:translateX(0);opacity:1} }
    @keyframes kenburns { from{transform:scale(1)} to{transform:scale(1.07)} }

    /* Header */
    header { position:sticky; top:0; z-index:100; background:rgba(12,12,13,0.92); backdrop-filter:blur(20px); border-bottom:1px solid var(--border); padding:0 2.5rem; display:flex; align-items:center; justify-content:space-between; height:64px; animation:fadeDown 0.6s ease both; }
    .wordmark { font-family:'Cormorant Garamond',serif; font-size:1.7rem; font-weight:300; letter-spacing:0.12em; color:var(--gold); text-decoration:none; }
    .wordmark em { color:var(--text-muted); font-style:italic; font-size:0.82rem; letter-spacing:0.05em; margin-left:0.5rem; }
    .bucket-badge { display:inline-flex; align-items:center; gap:0.4rem; background:var(--surface2); border:1px solid var(--border); padding:0.3rem 0.75rem; font-size:0.68rem; color:var(--gold-dim); letter-spacing:0.1em; }
    .bucket-badge::before { content:''; width:6px; height:6px; border-radius:50%; background:var(--gold); animation:pulse 2s infinite; }

    /* Flash */
    .flash-container { position:fixed; top:72px; right:1.5rem; z-index:200; display:flex; flex-direction:column; gap:0.5rem; max-width:340px; }
    .flash { padding:0.75rem 1.1rem; font-size:0.72rem; letter-spacing:0.05em; border-left:3px solid; animation:slideIn 0.3s ease; }
    .flash.success { background:rgba(90,154,106,0.12); border-color:var(--success); color:#8fcf9f; }
    .flash.error   { background:rgba(192,80,74,0.12);  border-color:var(--danger);  color:#e08080; }
    .flash.warning { background:rgba(184,144,58,0.12); border-color:#b8903a; color:#d4a84e; }

    /* Toast */
    .toast { position:fixed; bottom:2rem; left:50%; transform:translateX(-50%) translateY(80px); background:var(--surface2); border:1px solid var(--border); color:var(--text); padding:0.75rem 1.5rem; font-size:0.72rem; letter-spacing:0.08em; transition:transform 0.35s cubic-bezier(0.34,1.56,0.64,1),opacity 0.3s; opacity:0; z-index:700; pointer-events:none; }
    .toast.show { transform:translateX(-50%) translateY(0); opacity:1; }
    .toast.success { border-color:var(--success); color:#8fcf9f; }

    /* Lightbox */
    .lightbox { display:none; position:fixed; inset:0; z-index:300; background:rgba(0,0,0,0.96); align-items:center; justify-content:center; }
    .lightbox.open { display:flex; animation:fadeIn 0.2s ease; }
    .lightbox-inner { max-width:90vw; max-height:90vh; display:flex; align-items:center; justify-content:center; }
    .lightbox-inner img { max-width:85vw; max-height:85vh; object-fit:contain; border:1px solid var(--border); animation:scaleIn 0.2s ease; }
    .lightbox-close { position:fixed; top:1.5rem; right:1.5rem; background:none; border:1px solid var(--border); color:var(--text-muted); width:40px; height:40px; font-size:1rem; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:all 0.2s; }
    .lightbox-close:hover { color:var(--text); border-color:var(--gold); }
    .lightbox-info { position:fixed; bottom:1.5rem; left:50%; transform:translateX(-50%); font-size:0.68rem; color:var(--text-muted); letter-spacing:0.1em; white-space:nowrap; }

    /* Slideshow */
    .slideshow { display:none; position:fixed; inset:0; z-index:500; background:#000; }
    .slideshow.open { display:block; animation:fadeIn 0.3s ease; }
    .ss-slide { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; opacity:0; transition:opacity 0.9s ease; pointer-events:none; }
    .ss-slide.active { opacity:1; pointer-events:auto; }
    .ss-slide img { max-width:100vw; max-height:100vh; object-fit:contain; display:block; user-select:none; }
    .ss-slide.active img { animation:kenburns 6s ease-in-out forwards; }
    .ss-progress { position:absolute; top:0; left:0; right:0; height:2px; background:rgba(255,255,255,0.06); z-index:20; }
    .ss-fill { height:100%; background:var(--gold); width:0%; transition:width 0.1s linear; }
    .ss-overlay-top { position:absolute; top:0; left:0; right:0; height:140px; background:linear-gradient(to bottom,rgba(0,0,0,0.55),transparent); z-index:10; pointer-events:none; }
    .ss-overlay-bottom { position:absolute; bottom:0; left:0; right:0; height:200px; background:linear-gradient(to top,rgba(0,0,0,0.78),transparent); z-index:10; pointer-events:none; }
    .ss-caption { position:absolute; bottom:0; left:0; right:0; padding:2rem 2.5rem; z-index:15; display:flex; align-items:flex-end; justify-content:space-between; }
    .ss-caption-name { font-family:'Cormorant Garamond',serif; font-size:1.6rem; font-weight:300; color:rgba(255,255,255,0.9); letter-spacing:0.06em; }
    .ss-caption-meta { font-size:0.65rem; color:rgba(255,255,255,0.38); letter-spacing:0.12em; margin-top:0.25rem; }
    .ss-counter { font-size:0.7rem; color:rgba(255,255,255,0.28); letter-spacing:0.18em; padding-bottom:0.2rem; }
    .ss-controls { position:absolute; top:1.4rem; right:1.5rem; display:flex; align-items:center; gap:0.5rem; z-index:20; }
    .ss-btn { background:rgba(255,255,255,0.08); border:1px solid rgba(255,255,255,0.14); color:rgba(255,255,255,0.7); width:44px; height:44px; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:1rem; transition:all 0.2s; backdrop-filter:blur(10px); }
    .ss-btn:hover { background:rgba(255,255,255,0.18); color:#fff; border-color:rgba(255,255,255,0.4); }
    .ss-arrow { position:absolute; top:50%; transform:translateY(-50%); background:rgba(0,0,0,0.32); border:1px solid rgba(255,255,255,0.1); color:rgba(255,255,255,0.6); width:54px; height:54px; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:1.4rem; transition:all 0.2s; backdrop-filter:blur(6px); z-index:20; }
    .ss-arrow:hover { background:rgba(0,0,0,0.65); color:#fff; border-color:rgba(255,255,255,0.35); }
    .ss-prev { left:1.5rem; } .ss-next { right:1.5rem; }

    /* Main */
    main { max-width:1400px; margin:0 auto; padding:3rem 2.5rem; position:relative; z-index:1; }
    .section-label { font-size:0.65rem; text-transform:uppercase; letter-spacing:0.25em; color:var(--gold-dim); margin-bottom:0.75rem; }

    /* Breadcrumb + page header */
    .breadcrumb { font-size:0.68rem; color:var(--text-muted); letter-spacing:0.1em; margin-bottom:0.5rem; animation:fadeUp 0.5s ease both; }
    .breadcrumb a { color:var(--gold-dim); text-decoration:none; transition:color 0.2s; }
    .breadcrumb a:hover { color:var(--gold); }
    .breadcrumb span { margin:0 0.5rem; opacity:0.4; }

    .page-header { display:flex; align-items:flex-end; justify-content:space-between; margin-bottom:2.5rem; animation:fadeUp 0.6s 0.05s ease both; }
    .page-title { font-family:'Cormorant Garamond',serif; font-size:2.8rem; font-weight:300; letter-spacing:0.04em; }
    .header-actions { display:flex; align-items:center; gap:0.75rem; padding-bottom:0.3rem; }

    /* Slideshow trigger button in header */
    .btn-start-ss {
      display:inline-flex; align-items:center; gap:0.5rem;
      background:rgba(144,184,216,0.12); border:1px solid rgba(144,184,216,0.25);
      color:var(--blue); padding:0.5rem 1.1rem;
      font-family:'DM Mono',monospace; font-size:0.68rem; letter-spacing:0.12em;
      text-transform:uppercase; cursor:pointer; transition:all 0.2s;
    }
    .btn-start-ss:hover { background:rgba(144,184,216,0.25); }
    .photo-count-label { font-size:0.68rem; color:var(--text-muted); letter-spacing:0.12em; }

    /* Upload */
    .upload-section { margin-bottom:2.5rem; animation:fadeUp 0.7s 0.1s ease both; }
    .drop-zone { border:1px dashed var(--border); background:var(--surface); padding:2rem; text-align:center; cursor:pointer; transition:all 0.25s; position:relative; }
    .drop-zone:hover,.drop-zone.drag-over { border-color:var(--gold); background:rgba(200,169,110,0.04); }
    .drop-zone input[type="file"] { position:absolute; inset:0; opacity:0; cursor:pointer; width:100%; height:100%; }
    .drop-icon { font-size:1.8rem; margin-bottom:0.75rem; opacity:0.3; }
    .drop-title { font-family:'Cormorant Garamond',serif; font-size:1.2rem; font-weight:300; color:var(--text); margin-bottom:0.3rem; }
    .drop-sub { font-size:0.68rem; color:var(--text-muted); letter-spacing:0.06em; }
    .upload-btn { display:inline-block; margin-top:1rem; background:var(--gold); color:#0c0c0d; border:none; padding:0.6rem 1.75rem; font-family:'DM Mono',monospace; font-size:0.7rem; letter-spacing:0.15em; text-transform:uppercase; cursor:pointer; transition:background 0.2s; }
    .upload-btn:hover { background:#d4b87e; }
    .progress-wrap { display:none; width:100%; height:2px; background:var(--surface2); margin-top:0.75rem; }
    .progress-bar  { height:100%; background:var(--gold); width:0%; transition:width 0.3s; }

    /* Divider */
    .divider { height:1px; background:linear-gradient(to right,transparent,var(--border),transparent); margin:2rem 0; }

    /* Gallery */
    .gallery-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:1.5px; }
    .photo-card { position:relative; aspect-ratio:1; overflow:hidden; background:var(--surface); cursor:pointer; animation:scaleIn 0.5s ease both; }
    .photo-card img { width:100%; height:100%; object-fit:cover; display:block; filter:brightness(0.9) saturate(0.85); transition:transform 0.5s cubic-bezier(0.25,0.46,0.45,0.94),filter 0.3s; }
    .photo-card:hover img { transform:scale(1.07); filter:brightness(1) saturate(1.1); }
    .photo-overlay { position:absolute; inset:0; background:linear-gradient(to top,rgba(0,0,0,0.88) 0%,transparent 55%); opacity:0; transition:opacity 0.3s; display:flex; flex-direction:column; justify-content:flex-end; padding:0.9rem; }
    .photo-card:hover .photo-overlay { opacity:1; }
    .photo-name { font-size:0.7rem; color:#fff; letter-spacing:0.04em; margin-bottom:0.3rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .photo-meta { font-size:0.6rem; color:rgba(255,255,255,0.4); letter-spacing:0.08em; margin-bottom:0.65rem; }
    .photo-actions { display:flex; gap:0.35rem; }
    .btn-action { flex:1; padding:0.42rem 0; font-family:'DM Mono',monospace; font-size:0.58rem; letter-spacing:0.07em; text-transform:uppercase; text-align:center; cursor:pointer; border:none; transition:all 0.15s; text-decoration:none; display:block; }
    .btn-download  { background:rgba(200,169,110,0.2); color:var(--gold); border:1px solid rgba(200,169,110,0.3); }
    .btn-download:hover  { background:rgba(200,169,110,0.38); }
    .btn-slideshow { background:rgba(144,184,216,0.15); color:var(--blue); border:1px solid rgba(144,184,216,0.28); }
    .btn-slideshow:hover { background:rgba(144,184,216,0.32); }
    .btn-delete    { background:rgba(192,80,74,0.15); color:#e08080; border:1px solid rgba(192,80,74,0.28); }
    .btn-delete:hover    { background:rgba(192,80,74,0.32); }

    /* Empty */
    .empty-state { text-align:center; padding:5rem 2rem; border:1px dashed var(--border); }
    .empty-icon  { font-size:2.5rem; opacity:0.15; margin-bottom:1rem; }
    .empty-title { font-family:'Cormorant Garamond',serif; font-size:1.8rem; font-weight:300; color:var(--text-muted); margin-bottom:0.4rem; }
    .empty-sub   { font-size:0.68rem; color:var(--text-muted); opacity:0.5; letter-spacing:0.07em; }
  </style>
</head>
<body>

<div class="flash-container">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% for category, message in messages %}
      <div class="flash {{ category }}">{{ message }}</div>
    {% endfor %}
  {% endwith %}
</div>

<div class="toast" id="toast"></div>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
  <button class="lightbox-close" id="lb-close">✕</button>
  <div class="lightbox-inner"><img id="lb-img" src="" alt=""/></div>
  <div class="lightbox-info" id="lb-info"></div>
</div>

<!-- Slideshow -->
<div class="slideshow" id="slideshow">
  <div class="ss-progress"><div class="ss-fill" id="ss-fill"></div></div>
  <div class="ss-overlay-top"></div>
  <div class="ss-overlay-bottom"></div>
  <div id="ss-slides"></div>
  <button class="ss-arrow ss-prev" id="ss-prev">&#8592;</button>
  <button class="ss-arrow ss-next" id="ss-next">&#8594;</button>
  <div class="ss-controls">
    <button class="ss-btn" id="ss-playpause">&#10074;&#10074;</button>
    <button class="ss-btn" id="ss-exit">✕</button>
  </div>
  <div class="ss-caption">
    <div>
      <div class="ss-caption-name" id="ss-name"></div>
      <div class="ss-caption-meta"  id="ss-meta"></div>
    </div>
    <div class="ss-counter" id="ss-counter"></div>
  </div>
</div>

<header>
  <a class="wordmark" href="{{ url_for('index') }}">LUMINA <em>photo vault</em></a>
  <div class="bucket-badge">{{ bucket or 'not configured' }}</div>
</header>

<main>
  <!-- Breadcrumb -->
  <div class="breadcrumb">
    <a href="{{ url_for('index') }}">Albums</a>
    <span>›</span>
    {{ album_name }}
  </div>

  <!-- Page header -->
  <div class="page-header">
    <div>
      <div class="section-label">Album</div>
      <div class="page-title">{{ album_name }}</div>
    </div>
    <div class="header-actions">
      {% if photos %}
      <span class="photo-count-label">{{ photos|length }} photo{{ 's' if photos|length != 1 }}</span>
      <button class="btn-start-ss" onclick="startSlideshow(0)">▶ Slideshow</button>
      {% endif %}
    </div>
  </div>

  <!-- Upload -->
  <div class="upload-section">
    <div class="section-label">Add to {{ album_name }}</div>
    <form id="upload-form" action="{{ url_for('upload', album_id=album_id) }}"
          method="POST" enctype="multipart/form-data">
      <div class="drop-zone" id="drop-zone">
        <input type="file" name="files" id="file-input" multiple accept="image/*"/>
        <div class="drop-icon">⬡</div>
        <div class="drop-title">Drop photos into this album</div>
        <div class="drop-sub">PNG, JPG, WEBP, GIF, BMP supported</div>
        <button type="submit" class="upload-btn" id="upload-btn" style="display:none">Upload Selected</button>
      </div>
      <div class="progress-wrap" id="progress-wrap"><div class="progress-bar" id="progress-bar"></div></div>
    </form>
  </div>

  <div class="divider"></div>

  <!-- Gallery -->
  {% if photos %}
  <div class="gallery-grid">
    {% for photo in photos %}
    <div class="photo-card" style="animation-delay:{{ loop.index0 * 0.04 }}s">
      <img src="{{ photo.url }}" alt="{{ photo.filename }}" loading="lazy"
           onclick="openLightbox('{{ photo.url }}','{{ photo.filename }}','{{ photo.last_modified }}','{{ (photo.size / 1024)|round(1) }} KB')"/>
      <div class="photo-overlay">
        <div class="photo-name">{{ photo.filename }}</div>
        <div class="photo-meta">{{ photo.last_modified }} · {{ (photo.size / 1024)|round(1) }} KB</div>
        <div class="photo-actions">
          <a class="btn-action btn-download" href="{{ url_for('download', key=photo.key) }}">↓ Save</a>
          <button class="btn-action btn-slideshow"
                  onclick="startSlideshow({{ loop.index0 }})">▶ Show</button>
          <form method="POST" action="{{ url_for('delete', key=photo.key) }}" style="flex:1;display:flex;"
                onsubmit="return confirm('Delete {{ photo.filename }}?')">
            <button type="submit" class="btn-action btn-delete">✕ Del</button>
          </form>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="empty-state">
    <div class="empty-icon">◻</div>
    <div class="empty-title">Album is empty</div>
    <div class="empty-sub">Drop some photos above to add them here</div>
  </div>
  {% endif %}
</main>

<script>
// Photos array from server
const PHOTOS = [
  {% for photo in photos %}
  { url:"{{ photo.url }}", filename:"{{ photo.filename }}", date:"{{ photo.last_modified }}", size:"{{ (photo.size / 1024)|round(1) }} KB" }{{ "," if not loop.last }}
  {% endfor %}
];

// ── Upload drag & drop ────────────────────────────────────────
const dropZone  = document.getElementById('drop-zone');
const fileInput = document.getElementById('file-input');
const uploadBtn = document.getElementById('upload-btn');
dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('drag-over'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
dropZone.addEventListener('drop', e => {
  e.preventDefault(); dropZone.classList.remove('drag-over');
  fileInput.files = e.dataTransfer.files; handleFileSelect();
});
fileInput.addEventListener('change', handleFileSelect);
function handleFileSelect() {
  if (!fileInput.files.length) return;
  uploadBtn.style.display = 'inline-block';
  uploadBtn.textContent = `Upload ${fileInput.files.length} file${fileInput.files.length > 1 ? 's' : ''}`;
}

// ── Flash auto-hide ───────────────────────────────────────────
setTimeout(() => {
  document.querySelectorAll('.flash').forEach(el => {
    el.style.transition = 'opacity 0.5s'; el.style.opacity = '0';
    setTimeout(() => el.remove(), 500);
  });
}, 4000);

// ── Toast ─────────────────────────────────────────────────────
let toastTimer;
function showToast(msg, type='') {
  const t = document.getElementById('toast');
  t.textContent = msg; t.className = `toast ${type} show`;
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 3200);
}

// ── Lightbox ──────────────────────────────────────────────────
function openLightbox(url, name, date, size) {
  document.getElementById('lb-img').src = url;
  document.getElementById('lb-info').textContent = `${name}  ·  ${date}  ·  ${size}`;
  document.getElementById('lightbox').classList.add('open');
  document.body.style.overflow = 'hidden';
}
function closeLightbox() {
  document.getElementById('lightbox').classList.remove('open');
  document.getElementById('lb-img').src = '';
  document.body.style.overflow = '';
}
document.getElementById('lb-close').onclick = closeLightbox;
document.getElementById('lightbox').onclick = e => {
  if (e.target === document.getElementById('lightbox')) closeLightbox();
};

// ── Slideshow ─────────────────────────────────────────────────
const SLIDE_DURATION = 4500;
let ssIndex = 0, ssPlaying = true, ssProgressTimer = null, ssElapsed = 0, ssStart = null;

function buildSlides() {
  document.getElementById('ss-slides').innerHTML = PHOTOS.map((p, i) => `
    <div class="ss-slide" id="ss-s${i}">
      <img src="${p.url}" alt="${p.filename}" draggable="false"/>
    </div>`).join('');
}

function goTo(index) {
  const n = PHOTOS.length;
  ssIndex = ((index % n) + n) % n;
  document.querySelectorAll('.ss-slide').forEach(el => el.classList.remove('active'));
  const slide = document.getElementById(`ss-s${ssIndex}`);
  const img = slide.querySelector('img');
  img.replaceWith(img.cloneNode(true)); // retrigger kenburns
  slide.classList.add('active');
  const p = PHOTOS[ssIndex];
  document.getElementById('ss-name').textContent    = p.filename;
  document.getElementById('ss-meta').textContent    = `${p.date}  ·  ${p.size}`;
  document.getElementById('ss-counter').textContent = `${ssIndex + 1} / ${n}`;
  stopProgress(); ssElapsed = 0;
  document.getElementById('ss-fill').style.width = '0%';
  if (ssPlaying) runProgress();
}

function runProgress() {
  ssStart = Date.now() - ssElapsed;
  ssProgressTimer = setInterval(() => {
    ssElapsed = Date.now() - ssStart;
    const pct = Math.min((ssElapsed / SLIDE_DURATION) * 100, 100);
    document.getElementById('ss-fill').style.width = pct + '%';
    if (ssElapsed >= SLIDE_DURATION) { stopProgress(); goTo(ssIndex + 1); }
  }, 50);
}
function stopProgress() { clearInterval(ssProgressTimer); ssProgressTimer = null; }

function startSlideshow(fromIndex = 0) {
  if (!PHOTOS.length) return;
  buildSlides();
  ssPlaying = true;
  document.getElementById('ss-playpause').innerHTML = '&#10074;&#10074;';
  document.getElementById('slideshow').classList.add('open');
  document.body.style.overflow = 'hidden';
  goTo(fromIndex);
}
function exitSlideshow() {
  stopProgress(); ssElapsed = 0;
  document.getElementById('ss-fill').style.width = '0%';
  document.getElementById('slideshow').classList.remove('open');
  document.body.style.overflow = '';
}
function togglePlay() {
  ssPlaying = !ssPlaying;
  document.getElementById('ss-playpause').innerHTML = ssPlaying ? '&#10074;&#10074;' : '&#9654;';
  if (ssPlaying) runProgress(); else stopProgress();
}
function ssStep(dir) { stopProgress(); ssElapsed = 0; goTo(ssIndex + dir); }

document.getElementById('ss-exit').onclick     = exitSlideshow;
document.getElementById('ss-playpause').onclick = togglePlay;
document.getElementById('ss-prev').onclick      = () => ssStep(-1);
document.getElementById('ss-next').onclick      = () => ssStep(1);

document.addEventListener('keydown', e => {
  const ssOpen = document.getElementById('slideshow').classList.contains('open');
  const lbOpen = document.getElementById('lightbox').classList.contains('open');
  if (ssOpen) {
    if (e.key === 'Escape')     exitSlideshow();
    if (e.key === 'ArrowRight') ssStep(1);
    if (e.key === 'ArrowLeft')  ssStep(-1);
    if (e.key === ' ')          { e.preventDefault(); togglePlay(); }
  } else if (lbOpen) {
    if (e.key === 'Escape') closeLightbox();
  }
});
</script>
</body>
</html>
